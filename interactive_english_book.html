<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive English Learning Book</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1em;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .chapter-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .chapter-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .chapter-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .chapter-btn.active {
            background: rgba(255, 255, 255, 0.4);
            transform: translateY(-2px);
        }

        .book-content {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .chapter {
            padding: 40px;
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .chapter.active {
            display: block;
        }

        .chapter h2 {
            color: #4a5568;
            font-size: 2.2em;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .lesson-content {
            background: #f8fafc;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .lesson-content h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .lesson-content p {
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .example {
            background: #e6fffa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #38b2ac;
        }

        .question-container {
            background: #fff;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            transition: all 0.3s ease;
        }

        .question-container:hover {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .question {
            font-size: 1.2em;
            margin-bottom: 20px;
            color: #2d3748;
            font-weight: 600;
        }

        .options {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }

        .option {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
        }

        .option:hover {
            background: #edf2f7;
            border-color: #667eea;
            transform: translateX(5px);
        }

        .option.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .option.correct {
            background: #48bb78;
            color: white;
            border-color: #48bb78;
        }

        .option.incorrect {
            background: #f56565;
            color: white;
            border-color: #f56565;
        }

        .input-question input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .input-question input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background: #a0aec0;
            cursor: not-allowed;
            transform: none;
        }

        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 500;
        }

        .feedback.correct {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .feedback.incorrect {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #fc8181;
        }

        .score {
            text-align: center;
            font-size: 1.2em;
            margin: 20px 0;
            color: #4a5568;
        }

        .drag-drop {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .drag-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
        }

        .drag-item {
            background: #667eea;
            color: white;
            padding: 12px;
            border-radius: 10px;
            cursor: grab;
            text-align: center;
            transition: all 0.3s ease;
            user-select: none;
        }

        .drag-item:hover {
            background: #5a67d8;
            transform: scale(1.05);
        }

        .drag-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .drop-zones {
            display: flex;
            flex-direction: column;
            gap: 10px;
            flex: 1;
        }

        .drop-zone {
            border: 2px dashed #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            min-height: 50px;
            transition: all 0.3s ease;
            position: relative;
        }

        .drop-zone.drag-over {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .drop-zone.filled {
            border-color: #48bb78;
            background: #c6f6d5;
        }

        .audio-player {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .audio-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }

        .play-btn {
            background: #667eea;
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5em;
            transition: all 0.3s ease;
        }

        .play-btn:hover {
            background: #5a67d8;
            transform: scale(1.1);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            color: white;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .chapter {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .drag-drop {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Interactive English Learning Book</h1>
            <p>Master English through interactive lessons and engaging exercises</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="score">Score: <span id="totalScore">0</span>/<span id="totalQuestions">0</span></div>
        </div>

        <div class="chapter-nav" id="chapterNav">
            <!-- Navigation buttons will be generated here -->
        </div>

        <div class="book-content" id="bookContent">
            <div class="loading" id="loadingIndicator">
                <div class="spinner"></div>
                <p>Loading content...</p>
            </div>
            <!-- Chapters will be loaded here -->
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="correctAnswers">0</div>
                <div>Correct Answers</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="accuracy">0%</div>
                <div>Accuracy</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="chaptersCompleted">0</div>
                <div>Chapters Completed</div>
            </div>
        </div>
    </div>

    <script>
        class InteractiveBook {
            constructor() {
                this.currentChapter = 0;
                this.chapters = [];
                this.userAnswers = {};
                this.stats = {
                    totalQuestions: 0,
                    correctAnswers: 0,
                    chaptersCompleted: 0
                };
                this.init();
            }

            async init() {
                try {
                    // Try to load from external JSON file, fallback to default content
                    await this.loadContent();
                    this.renderChapterNavigation();
                    this.showChapter(0);
                    this.updateStats();
                } catch (error) {
                    console.error('Error loading content:', error);
                    this.loadDefaultContent();
                }
            }

            async loadContent() {
                try {
                    // Try to load from external JSON file (for GitHub deployment)
                    const response = await fetch('./content.json');
                    if (response.ok) {
                        const data = await response.json();
                        this.chapters = data.chapters;
                        this.calculateTotalQuestions();
                        document.getElementById('loadingIndicator').style.display = 'none';
                        return;
                    }
                } catch (error) {
                    console.log('External content not found, using default content');
                }
                
                // Fallback to default content
                this.loadDefaultContent();
            }

            loadDefaultContent() {
                this.chapters = [
                    {
                        title: "Basic Grammar",
                        content: {
                            lesson: "Understanding the fundamentals of English grammar is essential for effective communication.",
                            explanation: "Grammar provides the rules and structure that help us form meaningful sentences.",
                            examples: [
                                "Subject + Verb + Object: 'I eat apples'",
                                "Present Simple: 'She works every day'",
                                "Past Simple: 'He visited London last year'"
                            ]
                        },
                        questions: [
                            {
                                type: "multiple-choice",
                                question: "What is the correct sentence structure?",
                                options: [
                                    "Subject + Verb + Object",
                                    "Verb + Subject + Object",
                                    "Object + Verb + Subject",
                                    "Subject + Object + Verb"
                                ],
                                correct: 0,
                                feedback: "The basic English sentence structure is Subject + Verb + Object."
                            },
                            {
                                type: "fill-in-blank",
                                question: "Complete the sentence: 'She _____ to school every day.'",
                                correct: "goes",
                                feedback: "The correct answer is 'goes' - third person singular present simple."
                            },
                            {
                                type: "drag-drop",
                                question: "Arrange these words to form a correct sentence:",
                                items: ["playing", "children", "are", "the", "outside"],
                                correct: ["the", "children", "are", "playing", "outside"],
                                feedback: "The correct order is: 'The children are playing outside.'"
                            }
                        ]
                    },
                    {
                        title: "Vocabulary Building",
                        content: {
                            lesson: "Expanding your vocabulary is crucial for better English communication.",
                            explanation: "Learning new words and their usage helps you express ideas more clearly and precisely.",
                            examples: [
                                "Synonyms: Happy = Joyful, Glad, Cheerful",
                                "Antonyms: Hot ‚Üî Cold, Big ‚Üî Small",
                                "Word families: Create, Creation, Creative, Creator"
                            ]
                        },
                        questions: [
                            {
                                type: "multiple-choice",
                                question: "Which word is a synonym for 'happy'?",
                                options: ["Sad", "Angry", "Joyful", "Tired"],
                                correct: 2,
                                feedback: "'Joyful' is a synonym for 'happy' - they have similar meanings."
                            },
                            {
                                type: "fill-in-blank",
                                question: "The opposite of 'difficult' is _____.",
                                correct: "easy",
                                feedback: "'Easy' is the antonym of 'difficult'."
                            },
                            {
                                type: "matching",
                                question: "Match the words with their meanings:",
                                pairs: [
                                    { word: "Enormous", meaning: "Very large" },
                                    { word: "Tiny", meaning: "Very small" },
                                    { word: "Ancient", meaning: "Very old" }
                                ],
                                feedback: "Great job matching the words with their meanings!"
                            }
                        ]
                    },
                    {
                        title: "Reading Comprehension",
                        content: {
                            lesson: "Reading comprehension involves understanding and interpreting written text.",
                            explanation: "Good readers can identify main ideas, supporting details, and make inferences from the text.",
                            examples: [
                                "Main idea: The central point of a paragraph or passage",
                                "Supporting details: Facts that support the main idea",
                                "Context clues: Words that help understand unfamiliar terms"
                            ]
                        },
                        questions: [
                            {
                                type: "reading-passage",
                                passage: "The Amazon rainforest is the largest tropical rainforest in the world. It covers approximately 5.5 million square kilometers and is home to millions of species of plants and animals. The forest plays a crucial role in regulating the Earth's climate by absorbing carbon dioxide from the atmosphere.",
                                question: "What is the main idea of this passage?",
                                options: [
                                    "The Amazon is very large",
                                    "The Amazon is important for Earth's climate",
                                    "The Amazon has many animals",
                                    "The Amazon is a tropical forest"
                                ],
                                correct: 1,
                                feedback: "The main idea is that the Amazon rainforest is important for Earth's climate regulation."
                            },
                            {
                                type: "fill-in-blank",
                                question: "According to the passage, the Amazon rainforest covers approximately _____ million square kilometers.",
                                correct: "5.5",
                                feedback: "The passage states that the Amazon covers approximately 5.5 million square kilometers."
                            }
                        ]
                    }
                ];
                
                this.calculateTotalQuestions();
                document.getElementById('loadingIndicator').style.display = 'none';
            }

            calculateTotalQuestions() {
                this.stats.totalQuestions = this.chapters.reduce((total, chapter) => {
                    return total + chapter.questions.length;
                }, 0);
                document.getElementById('totalQuestions').textContent = this.stats.totalQuestions;
            }

            renderChapterNavigation() {
                const nav = document.getElementById('chapterNav');
                nav.innerHTML = this.chapters.map((chapter, index) => 
                    `<button class="chapter-btn ${index === 0 ? 'active' : ''}" onclick="book.showChapter(${index})">
                        ${index + 1}. ${chapter.title}
                    </button>`
                ).join('');
            }

            showChapter(index) {
                this.currentChapter = index;
                
                // Update navigation
                document.querySelectorAll('.chapter-btn').forEach((btn, i) => {
                    btn.classList.toggle('active', i === index);
                });

                // Render chapter content
                const content = document.getElementById('bookContent');
                const chapter = this.chapters[index];
                
                content.innerHTML = `
                    <div class="chapter active">
                        <h2>${chapter.title}</h2>
                        <div class="lesson-content">
                            <h3>Lesson</h3>
                            <p>${chapter.content.lesson}</p>
                            <h3>Explanation</h3>
                            <p>${chapter.content.explanation}</p>
                            <h3>Examples</h3>
                            ${chapter.content.examples.map(example => 
                                `<div class="example">${example}</div>`
                            ).join('')}
                        </div>
                        <div class="questions">
                            ${chapter.questions.map((q, i) => this.renderQuestion(q, index, i)).join('')}
                        </div>
                    </div>
                `;

                this.initializeDragDrop();
                this.updateProgress();
            }

            renderQuestion(question, chapterIndex, questionIndex) {
                const questionId = `q_${chapterIndex}_${questionIndex}`;
                
                switch(question.type) {
                    case 'multiple-choice':
                        return `
                            <div class="question-container">
                                <div class="question">${question.question}</div>
                                <div class="options">
                                    ${question.options.map((option, i) => 
                                        `<div class="option" onclick="book.selectOption('${questionId}', ${i})">
                                            ${option}
                                        </div>`
                                    ).join('')}
                                </div>
                                <button class="btn" onclick="book.checkAnswer('${questionId}')">Check Answer</button>
                                <div class="feedback" id="feedback_${questionId}"></div>
                            </div>
                        `;
                    
                    case 'fill-in-blank':
                        return `
                            <div class="question-container input-question">
                                <div class="question">${question.question}</div>
                                <input type="text" id="input_${questionId}" placeholder="Type your answer here...">
                                <button class="btn" onclick="book.checkFillInBlank('${questionId}')">Check Answer</button>
                                <div class="feedback" id="feedback_${questionId}"></div>
                            </div>
                        `;
                    
                    case 'drag-drop':
                        return `
                            <div class="question-container">
                                <div class="question">${question.question}</div>
                                <div class="drag-drop" id="dragdrop_${questionId}">
                                    <div class="drag-items">
                                        ${question.items.map((item, i) => 
                                            `<div class="drag-item" draggable="true" data-item="${item}">${item}</div>`
                                        ).join('')}
                                    </div>
                                    <div class="drop-zones">
                                        ${question.correct.map((_, i) => 
                                            `<div class="drop-zone" data-position="${i}">Drop here</div>`
                                        ).join('')}
                                    </div>
                                </div>
                                <button class="btn" onclick="book.checkDragDrop('${questionId}')">Check Answer</button>
                                <div class="feedback" id="feedback_${questionId}"></div>
                            </div>
                        `;
                    
                    case 'reading-passage':
                        return `
                            <div class="question-container">
                                <div class="lesson-content">
                                    <h3>Reading Passage</h3>
                                    <p>${question.passage}</p>
                                </div>
                                <div class="question">${question.question}</div>
                                <div class="options">
                                    ${question.options.map((option, i) => 
                                        `<div class="option" onclick="book.selectOption('${questionId}', ${i})">
                                            ${option}
                                        </div>`
                                    ).join('')}
                                </div>
                                <button class="btn" onclick="book.checkAnswer('${questionId}')">Check Answer</button>
                                <div class="feedback" id="feedback_${questionId}"></div>
                            </div>
                        `;
                    
                    default:
                        return '';
                }
            }

            selectOption(questionId, optionIndex) {
                const container = document.querySelector(`#feedback_${questionId}`).closest('.question-container');
                const options = container.querySelectorAll('.option');
                
                options.forEach(option => option.classList.remove('selected'));
                options[optionIndex].classList.add('selected');
                
                this.userAnswers[questionId] = optionIndex;
            }

            checkAnswer(questionId) {
                const [chapterIndex, questionIndex] = questionId.split('_').slice(1).map(Number);
                const question = this.chapters[chapterIndex].questions[questionIndex];
                const userAnswer = this.userAnswers[questionId];
                const feedbackElement = document.getElementById(`feedback_${questionId}`);
                
                if (userAnswer === undefined) {
                    feedbackElement.innerHTML = '<div class="feedback incorrect">Please select an answer first.</div>';
                    return;
                }
                
                const isCorrect = userAnswer === question.correct;
                
                // Update visual feedback
                const container = feedbackElement.closest('.question-container');
                const options = container.querySelectorAll('.option');
                
                options.forEach((option, index) => {
                    option.classList.remove('selected');
                    if (index === question.correct) {
                        option.classList.add('correct');
                    } else if (index === userAnswer && !isCorrect) {
                        option.classList.add('incorrect');
                    }
                });
                
                // Show feedback
                feedbackElement.innerHTML = `
                    <div class="feedback ${isCorrect ? 'correct' : 'incorrect'}">
                        ${isCorrect ? '‚úÖ Correct!' : '‚ùå Incorrect.'} ${question.feedback}
                    </div>
                `;
                
                // Update stats
                if (isCorrect) {
                    this.stats.correctAnswers++;
                }
                
                this.updateStats();
                
                // Disable further clicking
                options.forEach(option => option.style.pointerEvents = 'none');
                container.querySelector('.btn').disabled = true;
            }

            checkFillInBlank(questionId) {
                const [chapterIndex, questionIndex] = questionId.split('_').slice(1).map(Number);
                const question = this.chapters[chapterIndex].questions[questionIndex];
                const userAnswer = document.getElementById(`input_${questionId}`).value.trim().toLowerCase();
                const correctAnswer = question.correct.toLowerCase();
                const feedbackElement = document.getElementById(`feedback_${questionId}`);
                
                if (!userAnswer) {
                    feedbackElement.innerHTML = '<div class="feedback incorrect">Please enter an answer first.</div>';
                    return;
                }
                
                const isCorrect = userAnswer === correctAnswer;
                
                // Show feedback
                feedbackElement.innerHTML = `
                    <div class="feedback ${isCorrect ? 'correct' : 'incorrect'}">
                        ${isCorrect ? '‚úÖ Correct!' : '‚ùå Incorrect.'} ${question.feedback}
                    </div>
                `;
                
                // Update stats
                if (isCorrect) {
                    this.stats.correctAnswers++;
                }
                
                this.updateStats();
                
                // Disable input
                document.getElementById(`input_${questionId}`).disabled = true;
                const container = feedbackElement.closest('.question-container');
                container.querySelector('.btn').disabled = true;
            }

            initializeDragDrop() {
                const dragItems = document.querySelectorAll('.drag-item');
                const dropZones = document.querySelectorAll('.drop-zone');
                
                dragItems.forEach(item => {
                    item.addEventListener('dragstart', this.handleDragStart.bind(this));
                    item.addEventListener('dragend', this.handleDragEnd.bind(this));
                });
                
                dropZones.forEach(zone => {
                    zone.addEventListener('dragover', this.handleDragOver.bind(this));
                    zone.addEventListener('drop', this.handleDrop.bind(this));
                    zone.addEventListener('dragenter', this.handleDragEnter.bind(this));
                    zone.addEventListener('dragleave', this.handleDragLeave.bind(this));
                });
            }

            handleDragStart(e) {
                e.dataTransfer.setData('text/plain', e.target.textContent);
                e.target.classList.add('dragging');
            }

            handleDragEnd(e) {
                e.target.classList.remove('dragging');
            }

            handleDragOver(e) {
                e.preventDefault();
            }

            handleDragEnter(e) {
                e.preventDefault();
                e.target.classList.add('drag-over');
            }

            handleDragLeave(e) {
                e.target.classList.remove('drag-over');
            }

            handleDrop(e) {
                e.preventDefault();
                const data = e.dataTransfer.getData('text/plain');
                const dropZone = e.target;
                
                if (dropZone.classList.contains('drop-zone')) {
                    dropZone.textContent = data;
                    dropZone.classList.remove('drag-over');
                    dropZone.classList.add('filled');
                    
                    // Remove the dragged item
                    const draggedItem = document.querySelector('.drag-item.dragging');
                    if (draggedItem) {
                        draggedItem.remove();
                    }
                }
            }

            checkDragDrop(questionId) {
                const [chapterIndex, questionIndex] = questionId.split('_').slice(1).map(Number);
                const question = this.chapters[chapterIndex].questions[questionIndex];
                const dropZones = document.querySelectorAll(`#dragdrop_${questionId} .drop-zone`);
                const feedbackElement = document.getElementById(`feedback_${questionId}`);
                
                const userAnswer = Array.from(dropZones).map(zone => zone.textContent.trim()).filter(text => text !== 'Drop here');
                
                if (userAnswer.length !== question.correct.length) {
                    feedbackElement.innerHTML = '<div class="feedback incorrect">Please fill all positions first.</div>';
                    return;
                }
                
                const isCorrect = JSON.stringify(userAnswer) === JSON.stringify(question.correct);
                
                // Visual feedback
                dropZones.forEach((zone, index) => {
                    if (zone.textContent.trim() === question.correct[index]) {
                        zone.style.backgroundColor = '#c6f6d5';
                        zone.style.borderColor = '#48bb78';
                    } else {
                        zone.style.backgroundColor = '#fed7d7';
                        zone.style.borderColor = '#f56565';
                    }
                });
                
                // Show feedback
                feedbackElement.innerHTML = `
                    <div class="feedback ${isCorrect ? 'correct' : 'incorrect'}">
                        ${isCorrect ? '‚úÖ Correct!' : '‚ùå Incorrect.'} ${question.feedback}
                        <br><strong>Correct order:</strong> ${question.correct.join(' ‚Üí ')}
                    </div>
                `;
                
                // Update stats
                if (isCorrect) {
                    this.stats.correctAnswers++;
                }
                
                this.updateStats();
                
                // Disable further interaction
                const container = feedbackElement.closest('.question-container');
                container.querySelector('.btn').disabled = true;
            }

            updateStats() {
                const answeredQuestions = Object.keys(this.userAnswers).length;
                const accuracy = answeredQuestions > 0 ? Math.round((this.stats.correctAnswers / answeredQuestions) * 100) : 0;
                
                document.getElementById('totalScore').textContent = this.stats.correctAnswers;
                document.getElementById('correctAnswers').textContent = this.stats.correctAnswers;
                document.getElementById('accuracy').textContent = accuracy + '%';
                
                // Update progress bar
                const progressPercentage = (answeredQuestions / this.stats.totalQuestions) * 100;
                document.getElementById('progressFill').style.width = progressPercentage + '%';
                
                // Check if chapter is completed
                const currentChapterQuestions = this.chapters[this.currentChapter].questions.length;
                const currentChapterAnswered = Object.keys(this.userAnswers).filter(key => 
                    key.startsWith(`q_${this.currentChapter}_`)
                ).length;
                
                if (currentChapterAnswered === currentChapterQuestions) {
                    this.stats.chaptersCompleted = Math.max(this.stats.chaptersCompleted, this.currentChapter + 1);
                    document.getElementById('chaptersCompleted').textContent = this.stats.chaptersCompleted;
                }
            }

            updateProgress() {
                const answeredQuestions = Object.keys(this.userAnswers).length;
                const progressPercentage = (answeredQuestions / this.stats.totalQuestions) * 100;
                document.getElementById('progressFill').style.width = progressPercentage + '%';
            }

            // Audio functionality (placeholder for future implementation)
            playAudio(audioFile) {
                // This would integrate with audio files for pronunciation practice
                console.log('Playing audio:', audioFile);
                // Implementation would depend on audio file availability
            }

            // Save progress to localStorage (for local usage)
            saveProgress() {
                const progress = {
                    userAnswers: this.userAnswers,
                    stats: this.stats,
                    currentChapter: this.currentChapter
                };
                try {
                    localStorage.setItem('englishBookProgress', JSON.stringify(progress));
                } catch (e) {
                    console.log('Cannot save progress - localStorage not available');
                }
            }

            // Load progress from localStorage
            loadProgress() {
                try {
                    const saved = localStorage.getItem('englishBookProgress');
                    if (saved) {
                        const progress = JSON.parse(saved);
                        this.userAnswers = progress.userAnswers || {};
                        this.stats = { ...this.stats, ...progress.stats };
                        this.currentChapter = progress.currentChapter || 0;
                        return true;
                    }
                } catch (e) {
                    console.log('Cannot load progress - localStorage not available');
                }
                return false;
            }

            // Reset progress
            resetProgress() {
                this.userAnswers = {};
                this.stats = {
                    totalQuestions: this.stats.totalQuestions,
                    correctAnswers: 0,
                    chaptersCompleted: 0
                };
                this.currentChapter = 0;
                try {
                    localStorage.removeItem('englishBookProgress');
                } catch (e) {
                    console.log('Cannot clear progress - localStorage not available');
                }
                this.updateStats();
                this.showChapter(0);
            }

            // Export progress as JSON
            exportProgress() {
                const progress = {
                    userAnswers: this.userAnswers,
                    stats: this.stats,
                    currentChapter: this.currentChapter,
                    timestamp: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(progress, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = 'english_learning_progress.json';
                link.click();
            }
        }

        // Initialize the book when the page loads
        let book;
        window.addEventListener('DOMContentLoaded', () => {
            book = new InteractiveBook();
        });

        // Add some utility functions for enhanced interactivity
        function addChapterNavigation() {
            const navButtons = document.createElement('div');
            navButtons.className = 'chapter-navigation';
            navButtons.innerHTML = `
                <button class="btn" onclick="book.showChapter(Math.max(0, book.currentChapter - 1))">‚Üê Previous</button>
                <button class="btn" onclick="book.showChapter(Math.min(book.chapters.length - 1, book.currentChapter + 1))">Next ‚Üí</button>
            `;
            return navButtons;
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (book && book.chapters) {
                if (e.key === 'ArrowLeft' && book.currentChapter > 0) {
                    book.showChapter(book.currentChapter - 1);
                } else if (e.key === 'ArrowRight' && book.currentChapter < book.chapters.length - 1) {
                    book.showChapter(book.currentChapter + 1);
                }
            }
        });

        // Add smooth scrolling for better UX
        function smoothScrollTo(element) {
            element.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Add confetti animation for correct answers (simple version)
        function showConfetti() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7'];
            const confettiCount = 50;
            
            for (let i = 0; i < confettiCount; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'fixed';
                    confetti.style.width = '10px';
                    confetti.style.height = '10px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.top = '-10px';
                    confetti.style.borderRadius = '50%';
                    confetti.style.pointerEvents = 'none';
                    confetti.style.zIndex = '9999';
                    confetti.style.transition = 'all 3s ease-out';
                    
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.style.top = '100vh';
                        confetti.style.transform = 'rotate(720deg)';
                        confetti.style.opacity = '0';
                    }, 100);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 3000);
                }, i * 50);
            }
        }

        // Add touch support for mobile devices
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
        });

        document.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        });

        function handleSwipe() {
            if (!book || !book.chapters) return;
            
            const swipeThreshold = 50;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0 && book.currentChapter < book.chapters.length - 1) {
                    // Swipe left - next chapter
                    book.showChapter(book.currentChapter + 1);
                } else if (diff < 0 && book.currentChapter > 0) {
                    // Swipe right - previous chapter
                    book.showChapter(book.currentChapter - 1);
                }
            }
        }

        // Add print functionality
        function printChapter() {
            const printContent = document.querySelector('.chapter.active');
            if (printContent) {
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <html>
                        <head>
                            <title>English Learning - Chapter ${book.currentChapter + 1}</title>
                            <style>
                                body { font-family: Arial, sans-serif; margin: 20px; }
                                .question-container { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
                                .question { font-weight: bold; margin-bottom: 10px; }
                                .option { margin: 5px 0; }
                                @media print { body { margin: 0; } }
                            </style>
                        </head>
                        <body>
                            ${printContent.innerHTML}
                        </body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.print();
            }
        }
    </script>
</body>
</html>